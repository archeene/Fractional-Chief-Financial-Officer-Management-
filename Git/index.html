<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- FIXED: Updated CSP to allow localhost:3001 and Chrome DevTools -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: blob:; script-src 'self' 'unsafe-eval' 'sha256-Cf1CX6+5P2Da6cJGVmUk3Zx6HO/6uePtFzGSG9/7Krw=' 'sha256-vvt4KWwuNr51XfE5m+hzeNEGhiOfZzG97ccfqGsPwvE=' https://accounts.google.com https://cdn.jsdelivr.net; connect-src 'self' http://localhost:3001 https://accounts.google.com https://www.googleapis.com https://outlook.live.com https://outlook.office.com https://outlook.office365.com https://corsproxy.io https://api.allorigins.win https://cors-anywhere.herokuapp.com http://localhost:* ws://localhost:* blob:; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; object-src 'none'; base-uri 'self';">
  <title>Multi Calendar</title>
  <link rel="stylesheet" href="style.css">
  <script async src="https://accounts.google.com/gsi/client"></script>
</head>
<body>
  <div class="container">
    <div class="left-panel">
      <div class="toolbar">
        <button id="addCalendarBtn" class="toolbar-btn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
            <line x1="12" y1="14" x2="12" y2="18"></line>
            <line x1="10" y1="16" x2="14" y2="16"></line>
          </svg>
          Google Calendar
        </button>
        <button id="addOutlookBtn" class="toolbar-btn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
            <line x1="12" y1="14" x2="12" y2="18"></line>
            <line x1="10" y1="16" x2="14" y2="16"></line>
          </svg>
          Outlook Calendar
        </button>
      </div>
      <div id="dayCalendar"></div>
    </div>
    <div id="monthCalendar"></div>
  </div>

  <!-- Google Calendar Modal -->
  <div id="googleModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Import Google Calendar</h2>
        <button class="close-btn" id="closeGoogleModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="calendarId">Calendar ID</label>
          <input type="text" id="calendarId" placeholder="primary or your-email@gmail.com">
          <small>
            <strong>Setup required:</strong><br>
            1. Start the proxy server: <code>npm run server</code><br>
            2. Authenticate: Visit <a href="http://localhost:3001/auth" target="_blank" style="color: #4a9eff;">http://localhost:3001/auth</a><br>
            3. Enter your calendar ID below (use "primary" for your main calendar)<br>
            <br>
            <strong>Note:</strong> You only need to authenticate once. Your credentials will be saved.
          </small>
        </div>
        <div class="form-group">
          <label>Added Calendars</label>
          <ul id="addedCalendarsList" style="list-style: none; padding: 0; margin: 0; max-height: 200px; overflow-y: auto; color: #e0e0e0;"></ul>
        </div>
      </div>
      <div class="modal-footer">
        <button id="importCalendar" class="btn btn-primary">Import</button>
      </div>
    </div>
  </div>

  <!-- Outlook Calendar Modal -->
  <div id="outlookModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Import Outlook Calendar</h2>
        <button class="close-btn" id="closeOutlookModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>Status</label>
          <div id="outlookStatus" style="padding: 10px; background: rgba(55, 136, 216, 0.1); border-radius: 8px; margin-bottom: 15px;">
            No calendars added
          </div>
        </div>
        <div class="form-group">
          <label for="outlookIcalUrl">Outlook iCal URL</label>
          <input type="text" id="outlookIcalUrl" placeholder="https://outlook.live.com/owa/calendar/...">
          <small>
            <strong>How to get your iCal URL:</strong><br>
            1. Go to Outlook Web (outlook.live.com)<br>
            2. Click Calendar â†’ Right-click your calendar<br>
            3. Select "Publish calendar"<br>
            4. Copy the ICS link<br>
            <br>
          </small>
        </div>
        <div class="form-group">
          <button id="outlookImportBtn" class="btn btn-primary" style="width: 100%;">Import Calendar</button>
        </div>
        <div class="form-group" id="outlookCalendarsSection" style="display: none;">
          <label>Added Calendars</label>
          <div id="outlookCalendarsList" style="max-height: 300px; overflow-y: auto;"></div>
        </div>
        <div class="form-group" id="outlookActionsSection" style="display: none;">
          <small style="color: #5a7a9a;">Calendars auto-sync every 10 minutes</small>
        </div>
      </div>
    </div>
  </div>

  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.20/index.global.min.js'></script>
  <script src="app.js"></script>

  <!-- Event Modal -->
  <div id="eventModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">New Event</h2>
        <button class="close-btn" id="closeModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="eventTitle">Title</label>
          <input type="text" id="eventTitle" placeholder="Event title">
        </div>
        <div class="form-group">
          <label for="eventStart">Start</label>
          <input type="datetime-local" id="eventStart">
        </div>
        <div class="form-group">
          <label for="eventEnd">End</label>
          <input type="datetime-local" id="eventEnd">
        </div>
        <div class="form-group">
          <label>Color</label>
          <div class="color-picker">
            <button class="color-btn" data-color="#3788d8" style="background-color: #3788d8;"></button>
            <button class="color-btn" data-color="#28a745" style="background-color: #28a745;"></button>
            <button class="color-btn" data-color="#dc3545" style="background-color: #dc3545;"></button>
            <button class="color-btn" data-color="#ffc107" style="background-color: #ffc107;"></button>
            <button class="color-btn" data-color="#6f42c1" style="background-color: #6f42c1;"></button>
            <button class="color-btn" data-color="#fd7e14" style="background-color: #fd7e14;"></button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="deleteEvent" class="btn btn-danger" style="display: none;">Delete</button>
        <button id="saveEvent" class="btn btn-primary">Save</button>
      </div>
    </div>
  </div>
</body>
</html>